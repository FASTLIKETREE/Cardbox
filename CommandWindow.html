<html>
<head>

    <meta charset="utf-8"/>
    <title>Demo</title>
<style type="text/css">

#commandwindowcontainer
{
	height: 200px;
	width: 600px;
	background:#f00;
	overflow: auto;
}

#commandwindow
{
	//position: aboslute;
	top: 0px;
	left: 0px;

	height: 200px;
	width: 600px;

	background-color: #4FC4AF;

	display: table-cell;
    vertical-align: bottom;
	//overflow: scroll;
}

#currentdirectory{
	top: 600px;
	left: 0px;
	width: 600px;
	height: 20px;
	background-color: #F26161;
}



#commandline{
    resize: none;
	width: 600px;
	height: 60px;
	background-color: #95B4DB;
	white-space: nowrap;
	overflow: auto;
}

</style>

<script src="/socket.io/socket.io.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>

<script>

$(document).ready(function(){
	var RootReplaceKey = "C:\\AANode\\pictures"

	var rooms = 9
	//var CurrentDirectory = "root:\>"
	var CurrentDirectory = "C:\\AANode\\pictures"
	socket = io.connect();
	socket.emit("CommandWindowCreated")
	socket.emit("GetDirectoryStructure")

	var commandwindowdirectorydiv = document.getElementById("currentdirectory");
	commandwindowdirectorydiv.innerHTML = "root"

	document.addEventListener("keydown", function(e)
	{
		console.log(e.keyCode + "<-- this is the keycode")
		switch(e.keyCode)
		{
			case 13:
			if(e.shiftKey){
				console.log("This is shift enter, it will go to the next line instead of submitting the shit")

			}
			else{
				e.preventDefault()
				console.log("This should send the mail, this will send to all the people i guess?")

				var cmdline = document.getElementById("commandline");
				if(cmdline.value != ""){
					var SwitchedCommandLineInput = cmdline.value.split(" ")
					switch(SwitchedCommandLineInput[0]){
						case "dir":
							var cmdwnd = document.getElementById("commandwindow");
							var FilesAndDirsCurrentDirectory = LocalDirectoryStructureObject[CurrentDirectory]
							console.log(FilesAndDirsCurrentDirectory + "<-- this is the directory files and dirts after selecting object")
							console.log("Is this the split htat is faliing?")
							SplitFilesDirs = FilesAndDirsCurrentDirectory.split(";")
							console.log(SplitFilesDirs)

							var HTMLText = ""
							if(SplitFilesDirs[0].length > 1){
								var DirText = ""
								SplitDirs = SplitFilesDirs[0].split(",")
								for(var i = 0; i<SplitDirs.length; ++i){
									DirText = DirText + "Dir\>\t" + SplitDirs[i] + "<br/>"
								}
								HTMLText = HTMLText + DirText
							}

							if(SplitFilesDirs[1].length > 1){
								var FileText = ""
								SplitFiles = SplitFilesDirs[1].split(",")
								for(var i = 0; i<SplitFiles.length; ++i){
									FileText = FileText + "File\t" + SplitFiles[i] + "<br/>"
								}
								HTMLText = HTMLText + FileText
							}

							//HTMLText = HTMLText.replace(/\r?\n/g, '<br/>');
							cmdwnd.innerHTML = cmdwnd.innerHTML + "<br>" + HTMLText

							ScrollToEndOfChatBox()
							break
						case "cd":
							var DirectoryKeysArray = Object.keys(LocalDirectoryStructureObject)
							for(var i=0; i<DirectoryKeysArray.length; ++i){
								if(DirectoryKeysArray[i].toLowerCase() == (CurrentDirectory + "\\" + SwitchedCommandLineInput[1]).toLowerCase()){
									CurrentDirectory = DirectoryKeysArray[i]
									commandwindowdirectorydiv.innerHTML = CurrentDirectory.replace(RootReplaceKey, "root")
									break;
								}
							}
							console.log(CurrentDirectory + "<-- this is current directory")
							break
						case "cd..":
							var CurrentDirectoryArray = CurrentDirectory.split("\\")
							CurrentDirectory = CurrentDirectory.replace("\\" + CurrentDirectoryArray[CurrentDirectoryArray.length -1], "")
							commandwindowdirectorydiv.innerHTML = CurrentDirectory.replace(RootReplaceKey, "root")
							break
						case "cd\\":
							CurrentDirectory = RootReplaceKey
							commandwindowdirectorydiv.innerHTML = CurrentDirectory.replace(RootReplaceKey, "root")
							break
						default:
							var cmdwnd = document.getElementById("commandwindow");

							socket.emit("CommandLineSend", {"CommandLineRaw":cmdline.value})
							var HTMLText = cmdline.value
							HTMLText = HTMLText.replace(/\r?\n/g, '<br />');
							cmdwnd.innerHTML = cmdwnd.innerHTML + "<br>" + HTMLText
							console.log(cmdline.value + "<-- this is the current innerHTML")
							ScrollToEndOfChatBox()
							break
					}
				}
				cmdline.value = ""
			}
			break
			case 9:
			break

		}

	})



	socket.on("CommandLineRecv", function(data){
		var cmdwnd = document.getElementById("commandwindow");
		var HTMLText = data.CommandlineRaw
		HTMLText = HTMLText.replace(/\r?\n/g, '<br />');
		cmdwnd.innerHTML = cmdwnd.innerHTML + "<br>" + HTMLText
		ScrollToEndOfChatBox()
	})

	socket.on("DirectoryStructure", function(data){
		console.log("Does this ever get to the directory structure??!??")
		LocalDirectoryStructureObject = data.DirectoryStructure
		//jQuery.extend(LocalDirectoryStructureObject, data.DirectoryStructure)
		//LocalDirectoryStructureObject = data.DirectoryStructure
		console.log(data.DirectoryStructure)
		console.log(LocalDirectoryStructureObject)
	})

})




	/*
	var user = prompt("Enter your name, or don't")
	while(1)
	{
		if(user == null)
		{
			user = prompt("Enter your name, or don't")
		}
		else
		{
			break
		}
	}
*/

function ScrollToEndOfChatBox(){
	var cmdwndcontainer = document.getElementById("commandwindowcontainer");
	var scrollHeight = Math.max(cmdwndcontainer.scrollHeight, cmdwndcontainer.clientHeight);
	cmdwndcontainer.scrollTop = scrollHeight - cmdwndcontainer.clientHeight;
}


function ResizeWindow()
{
	var cmdwnd = document.getElementById("commandwindow");
	//alert("This has resized")
	console.log("The fuck is going on here?");
	console.log($(window).height() + "<-- this is the window height");
	console.log($(window).width() + "<-- this is the window width");
	cmdwnd.style.width = $(window).width() - 100;
	cmdwnd.style.height = $(window).height() - 100;

	var cmdline = document.getElementById("commandline");
	cmdline.style.width = $(window).width() - 100;

	var directorydiv = document.getElementById("currentdirectory");
	directorydiv.style.width = $(window).width() - 100;

	var cmdwndcontainer = document.getElementById("commandwindowcontainer");
	cmdwndcontainer.style.width = $(window).width() - 100;
	cmdwndcontainer.style.height = $(window).height() - 100;

	ScrollToEndOfChatBox()
}

</script>
</head>

<body onresize="ResizeWindow()">
<div id=commandwindowcontainer>
<div id=commandwindow></div>
</div>
<div id=currentdirectory></div>
<textarea id=commandline></textarea>

</body>
</html>